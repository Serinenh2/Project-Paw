<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Modern Attendance System</title>

  <!-- jQuery & Chart.js CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f4f6f9;
      color: #333;
      padding-bottom: 50px;
    }
    h2 { text-align: center; margin: 30px 0; color: #444; }

    .navbar {
      background: linear-gradient(135deg, #6619b5, #3b82f6);
      padding: 12px 20px;
      display: flex;
      gap: 20px;
      justify-content: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }
    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: 0.3s;
    }
    .navbar a:hover { color: #ffe78f; transform: translateY(-2px); }

    .table-container {
      width: 90%;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.1);
    }
    table { width: 100%; border-collapse: collapse; }
    th {
      background: #3b82f6;
      color: white;
      padding: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      vertical-align: middle;
    }
    tr.student { transition: 0.3s; }
    tr.student:hover {
      transform: scale(1.01);
      background: #f0f8ff;
    }

    .form-container {
      width: 350px;
      margin: 30px auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.1);
    }
    input[type=text] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
    }
    input[type=text]:focus { border-color: #3b82f6; }
    .btn {
      background: linear-gradient(135deg, #3b82f6, #6619b5);
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { transform: translateY(-2px); }

    .error { color: red; font-size: 13px; }
    .success { color: green; text-align: center; font-weight: 600; }

    .buttons-section { text-align: center; margin-top: 30px; }
    .action-btn {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
      background: #3b82f6;
      color: white;
    }
    .action-btn:hover { background: #2563eb; }

    .search-sort {
      width: 90%;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .search-input {
      width: 300px;
      max-width: 90%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      margin-bottom: 10px;
    }

    @media(max-width: 720px) {
      .navbar { flex-wrap: wrap; }
      .form-container, .table-container { width: 95%; }
      th, td { font-size: 12px; }
      .search-input { width: 100%; }
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
  <a href="#table">Attendance</a>
  <a href="#form">Add Student</a>
  <a href="#report">Report</a>
</div>

<!-- TABLE -->
<h2 id="table">Attendance Table</h2>
<div class="table-container">
  <table id="attendanceTable">
    <tr>
      <th>Last Name</th> <th>First Name</th>
      <th>S1</th><th>P1</th> <th>S2</th><th>P2</th> <th>S3</th><th>P3</th>
      <th>S4</th><th>P4</th> <th>S5</th><th>P5</th> <th>S6</th><th>P6</th>
      <th>Absences</th> <th>Participations</th> <th>Message</th>
    </tr>

    <tr class="student">
      <td>Ahmed</td><td>Sara</td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td></td><td></td><td></td>
    </tr>

    <tr class="student">
      <td>Yacine</td><td>Ali</td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated" checked></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated" checked></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated" checked></td>
      <td></td><td></td><td></td>
    </tr>

    <tr class="student">
      <td>Houcine</td><td>Rania</td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated" checked></td>
      <td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated" checked></td>
      <td><input type="checkbox" class="present" checked></td><td><input type="checkbox" class="participated"></td>
      <td></td><td></td><td></td>
    </tr>
  </table>
</div>

<script>
// Compute for a single row
function computeRow(row) {
  const cells = row.querySelectorAll("td");
  let abs = 0, par = 0;

  // Session pairs: (S,P) columns at indices: 2-3, 4-5, 6-7, 8-9, 10-11, 12-13
  for (let i = 2; i <= 13; i += 2) {
    const sBox = cells[i].querySelector("input.present");
    const pBox = cells[i + 1].querySelector("input.participated");
    if (!sBox.checked) abs++;
    if (pBox.checked) par++;
  }

  // Totals and message
  cells[14].innerText = abs;
  cells[15].innerText = par;

  if (abs < 3) {
    row.style.background = "#d4fcd6";
    cells[16].innerText = "Good attendance - Excellent participation";
  } else if (abs <= 4) {
    row.style.background = "#fff3b0";
    cells[16].innerText = "Warning - attendance low - You need to participate more";
  } else {
    row.style.background = "#ffb3b3";
    cells[16].innerText = "Excluded - too many absences - You need to participate more";
  }
}

// Update entire table
function updateTable() {
  document.querySelectorAll("#attendanceTable tr.student").forEach(computeRow);
}

// Initial compute
updateTable();

// Live updates on checkbox change (delegated so it works for future rows)
document.addEventListener("change", function(e) {
  if (e.target.matches("#attendanceTable input.present, #attendanceTable input.participated")) {
    const row = e.target.closest("tr.student");
    if (row) computeRow(row);
  }
});
</script>

<!-- FORM -->
<h2 id="form">Add Student</h2>
<div class="form-container">
  <form id="studentForm">
    <label>Last Name:</label>
    <input type="text" id="lname">
    <div id="errorL" class="error"></div>

    <label>First Name:</label>
    <input type="text" id="fname">
    <div id="errorF" class="error"></div>

    <button class="btn" type="submit">Add Student</button>
  </form>
  <p id="msg" class="success"></p>
</div>

<script>
document.getElementById("studentForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const lname = document.getElementById("lname").value.trim();
  const fname = document.getElementById("fname").value.trim();
  let ok = true;

  document.querySelectorAll(".error").forEach(el => el.innerText = "");

  if (!/^[A-Za-z]+$/.test(lname)) { document.getElementById("errorL").innerText = "Only letters allowed"; ok = false; }
  if (!/^[A-Za-z]+$/.test(fname)) { document.getElementById("errorF").innerText = "Only letters allowed"; ok = false; }
  if (!ok) return;

  // Create a row with interactive checkboxes for all 6 sessions
  const table = document.getElementById("attendanceTable");
  const row = table.insertRow(-1);
  row.classList.add("student");
  const cellsHTML =
    `<td>${lname}</td><td>${fname}</td>` +
    Array.from({ length: 6 }).map(() =>
      `<td><input type="checkbox" class="present"></td><td><input type="checkbox" class="participated"></td>`
    ).join('') +
    `<td></td><td></td><td></td>`;
  row.innerHTML = cellsHTML;

  // Compute totals and state for this new row
  computeRow(row);

  document.getElementById("msg").innerText = "Student added successfully!";
  (document.getElementById("studentForm")).reset();
});
</script>

<!-- REPORT / HIGHLIGHT / RESET -->
<div class="buttons-section">
  <h2 id="report">Report</h2>
  <button class="action-btn" id="btnShowReport">Show Report</button>
  <button class="action-btn" id="highlightBest">Highlight Excellent</button>
  <button class="action-btn" id="reset">Reset Colors</button>
</div>

<canvas id="reportChart" width="350" height="150"></canvas>

<script>
// Report counts present marks (checked present boxes) and participation marks (checked participated boxes)
function showReport() {
  const rows = document.querySelectorAll("#attendanceTable tr.student");
  let totalStudents = rows.length, presentMarks = 0, participationMarks = 0;

  rows.forEach(row => {
    const cells = row.querySelectorAll("td");
    for (let i = 2; i <= 13; i += 2) {
      const sBox = cells[i].querySelector("input.present");
      const pBox = cells[i + 1].querySelector("input.participated");
      if (sBox.checked) presentMarks++;
      if (pBox.checked) participationMarks++;
    }
  });

  new Chart(document.getElementById("reportChart"), {
    type: "bar",
    data: {
      labels: ["Total Students", "Present Marks (✓)", "Participation Marks (✓)"],
      datasets: [{
        label: "Attendance Report",
        data: [totalStudents, presentMarks, participationMarks],
        backgroundColor: ["#3b82f6", "#22c55e", "#f59e0b"]
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, ticks: { precision: 0 } } },
      plugins: { legend: { display: false } }
    }
  });
}

document.getElementById("btnShowReport").addEventListener("click", showReport);

// Delegated hover/click (works for new rows)
$(document).on("mouseenter", "tr.student", function() {
  $(this).css("box-shadow", "0 0 10px #aaa");
}).on("mouseleave", "tr.student", function() {
  $(this).css("box-shadow", "none");
}).on("click", "tr.student", function() {
  const last = $(this).children().eq(0).text();
  const first = $(this).children().eq(1).text();
  const abs = $(this).children().eq(14).text();
  alert(`${first} ${last} has ${abs} absences.`);
});

$("#highlightBest").click(function() {
  $("tr.student").each(function() {
    const abs = parseInt($(this).children().eq(14).text()) || 0;
    if (abs < 3) {
      $(this).css("border", "3px solid #22c55e")
             .fadeOut(200).fadeIn(200).fadeOut(200).fadeIn(200);
    }
  });
});

$("#reset").click(function() {
  $("tr.student").css({ border: "1px solid #ddd", background: "" });
  updateTable(); // restore class-based colors from current checkbox states
});
</script>

<!-- SEARCH & SORT -->
<div class="search-sort">
  <h2>Search & Sort</h2>
  <input type="text" id="searchBox" class="search-input" placeholder="Search by name (Last or First)..." />
  <div class="buttons-section" style="margin-top: 15px;">
    <button class="action-btn" id="sortAbs">Sort by Absences (Ascending)</button>
    <button class="action-btn" id="sortPar">Sort by Participation (Descending)</button>
  </div>
  <p id="sortMode"></p>
</div>

<script>
// Search by partial name
$("#searchBox").on("input", function() {
  const query = $(this).val().toLowerCase();
  $("#attendanceTable tr.student").each(function() {
    const last = $(this).children().eq(0).text().toLowerCase();
    const first = $(this).children().eq(1).text().toLowerCase();
    $(this).toggle(last.includes(query) || first.includes(query));
  });
});

// Sort helpers read current computed values
$("#sortAbs").click(function() {
  updateTable(); // ensure latest totals
  const rows = $("#attendanceTable tr.student").get();
  rows.sort(function(a, b) {
    const aAbs = parseInt($(a).children().eq(14).text()) || 0;
    const bAbs = parseInt($(b).children().eq(14).text()) || 0;
    return aAbs - bAbs;
  });
  $("#attendanceTable").append(rows);
  $("#sortMode").text("Currently sorted by absences (ascending).");
});

$("#sortPar").click(function() {
  updateTable();
  const rows = $("#attendanceTable tr.student").get();
  rows.sort(function(a, b) {
    const aPar = parseInt($(a).children().eq(15).text()) || 0;
    const bPar = parseInt($(b).children().eq(15).text()) || 0;
    return bPar - aPar;
  });
  $("#attendanceTable").append(rows);
  $("#sortMode").text("Currently sorted by participation (descending).");
});
</script>

</body>
</html>
